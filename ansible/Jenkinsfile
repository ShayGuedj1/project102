pipeline {
    agent any

    environment {
        // Define environment variables if needed
        ANSIBLE_PLAYBOOK = 'ansible/install-services.yaml'
        SSH_PRIVATE_KEY_ID = 'your_ssh_private_key_credential_id'
        PRIVATE_KEY_PATH = '/home/ubuntu/.ssh/id_rsa'
        IPS_FILE_PATH = '/home/ubuntu/inventory'

    }

    stages {
        stage('Run Ansible Playbook') {
            steps {
                steps {
                // Execute shell command to read IP address from 'inventory' file
                script {
                    def ipAddress = sh(script: "cat ${IPS_FILE_PATH}", returnStdout: true).trim()


                    
                    

                    // Execute Ansible playbook
                        ansiblePlaybook(
                            playbook: "${ANSIBLE_PLAYBOOK}",
                            inventory: "${IPS_FILE_PATH},",
                            extras: "-e ansible_ssh_private_key_file=${env.SSH_PRIVATE_KEY_ID}"
                        
                                      )
                }
                   }
              }
            }
        }
    }

    post {
        always {
            // Print 'done' at the end
            echo 'Done'
        }
    }
